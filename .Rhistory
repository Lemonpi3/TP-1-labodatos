fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<n_viajes[-13]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=2, method="gam") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<n_viajes[-15]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=2, method="gam") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<n_viajes[-5]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=2, method="gam") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<n_viajes[-50]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=2, method="gam") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<n_viajes[50]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=2, method="gam") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes=<n_viajes[50]), "Bottom 5", "Others")),
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[50]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=2, method="gam") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[49]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=2, method="gam") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=2, method="gam") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=2, method="gam", alpha = 0.7) +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=2, method="gam", alpha = 0.1) +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
geom_col(aes(fill = top_5)) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE)
#cant viajes por semana
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE) +
labs (
title = "Cantidad de viajes 2022",
subtitle = "Semanalmente"
)
#cant viajes por semana
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE) +
labs (
title = "Cantidad de viajes 2022",
subtitle = "Semanalmente"
) +
theme(
plot.title = element_text(size = 18, family ='sans-serif',face='bold', color = "white"),
plot.subtitle = element_text(size = 12, family = 'sans-serif', color = "grey80"),
)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE) +
labs (
title = "Cantidad de viajes 2022",
subtitle = "Semanalmente"
) +
theme(
plot.title = element_text(size = 18, family ='sans-serif',face='bold', color = "white"),
plot.subtitle = element_text(size = 12, family = 'sans-serif', color = "grey80"),
)
#cant viajes por semana
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE) +
labs (
title = "Cantidad de viajes 2022",
subtitle = "Semanalmente"
) +
theme(
plot.title = element_text(size = 18, family ='sans-serif',face='bold', color = "white"),
plot.subtitle = element_text(size = 12, family = 'sans-serif', color = "grey80"),
)
df_bici %>%
mutate(
fecha = lubridate::ceiling_date(fecha, "week"),
semana = lubridate::week(fecha)
) %>%
group_by(semana) %>%
summarise(
n_viajes = n_distinct(id_recorrido),
fecha =  format(fecha[1], "%d\n%b")
) %>%
arrange(desc(n_viajes)) %>%
mutate(
top_5 = ifelse((n_viajes>=n_viajes[5]), "Top 5", ifelse((n_viajes<=n_viajes[48]), "Bottom 5", "Others")),
) %>%
ggplot(aes(x = semana, y = n_viajes)) +
geom_col(aes(fill = top_5)) +
geom_smooth(aes(y=n_viajes),se=F, color="#ffbe0b", size=1.5, method="gam", alpha = 0.1) +
geom_text(aes(label = n_viajes), position = position_stack(vjust = 0.5), color = "black") +
geom_text(aes(label = fecha, y = n_viajes + 1), position = position_stack(vjust = 1.06), color = "white") +
scale_x_continuous(breaks = seq(from = 1, to = 53, by = 1)) +
scale_fill_manual(values = c("Top 5" = "turquoise", "Others" = "gray80", "Bottom 5" = "#fb5607")) +
guides(fill = FALSE) +
labs (
title = "Cantidad de viajes 2022",
subtitle = "Semanalmente"
) +
theme(
plot.title = element_text(size = 18, family ='sans-serif',face='bold', color = "white"),
plot.subtitle = element_text(size = 12, family = 'sans-serif', color = "grey80"),
)
